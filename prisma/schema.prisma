generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  extensions = [vector]
}

model Chat {
  id          String    @id @default(cuid())
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  messages    Message[]
  forks       Json
  activeFork  Int?
  stars       Int[]
  highlights  Json[]
}

model Message {
  id                    String    @id @default(cuid())
  chronologicalId       Int
  chronologicalParentId Int?
  role                  String
  content               String    @db.Text
  contentHash           String?
  reasoningContent      String?   @db.Text
  signature             String?   @db.Text
  model                 Json?
  temperature           Float?
  topP                  Float?
  reasoningEffort       String?
  verbosity             String?
  tools                 Json?
  toolUses              Json?
  usage                 Json?
  systemPromptId        String?
  systemPromptTitle     String?
  systemPromptIsDefault Boolean?  @default(false)
  raw                   Json?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  chat                  Chat      @relation(fields: [chatId], references: [id], onDelete: Cascade)
  chatId                String

  @@index([chatId, chronologicalId])
  @@index([contentHash])
}

model SystemPrompt {
  id          String    @id @default(cuid())
  message     String    @db.Text
  contentHash String?
  title       String
  active      Boolean   @default(false)
  default     Boolean   @default(false)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([contentHash])
}

model Embedding {
  contentHash String                       @id
  vector      Unsupported("vector(1536)")
  model       String                       @default("text-embedding-3-small")
  createdAt   DateTime                     @default(now())
}
